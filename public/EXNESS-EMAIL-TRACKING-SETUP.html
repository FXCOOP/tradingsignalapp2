<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>🎯 Exness Email Tracking - Setup Guide</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:40px 20px;color:#333}.container{max-width:1000px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);padding:50px;overflow:hidden}h1{font-size:2.5em;margin-bottom:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center}h2{color:#667eea;margin-top:40px;margin-bottom:20px;font-size:1.8em;border-bottom:3px solid #667eea;padding-bottom:10px}h3{color:#764ba2;margin-top:30px;margin-bottom:15px;font-size:1.3em}.subtitle{text-align:center;color:#666;font-size:1.2em;margin-bottom:40px}.step{background:#f8f9ff;border-left:5px solid #667eea;padding:25px;margin-bottom:25px;border-radius:8px}.step-number{background:#667eea;color:#fff;width:40px;height:40px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-weight:700;margin-right:15px;font-size:1.2em}.step-title{font-size:1.4em;font-weight:700;color:#333;margin-bottom:15px;display:flex;align-items:center}.code-block{background:#1e1e1e;color:#00ff00;padding:20px;border-radius:10px;font-family:'Courier New',monospace;font-size:.9em;margin:20px 0;overflow-x:auto;position:relative}.code-block pre{margin:0;white-space:pre-wrap;word-wrap:break-word}.copy-btn{position:absolute;top:10px;right:10px;background:#667eea;color:#fff;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;font-size:.85em;transition:all .3s}.copy-btn:hover{background:#764ba2;transform:translateY(-2px)}.success-box{background:#d4edda;border-left:5px solid #28a745;padding:20px;margin:20px 0;border-radius:8px;color:#155724}.warning-box{background:#fff3cd;border-left:5px solid#ffc107;padding:20px;margin:20px 0;border-radius:8px;color:#856404}.info-box{background:#d1ecf1;border-left:5px solid #17a2b8;padding:20px;margin:20px 0;border-radius:8px;color:#0c5460}.flow-diagram{background:#fff;border:2px solid #667eea;padding:30px;margin:30px 0;border-radius:12px}.flow-step{background:#f8f9ff;padding:15px;margin:15px 0;border-radius:8px;border-left:4px solid #667eea}.arrow{text-align:center;font-size:2em;color:#667eea;margin:10px 0}.checklist{list-style:none;margin:20px 0}.checklist li{background:#f8f9ff;padding:15px;margin:10px 0;border-radius:8px;border-left:4px solid #667eea;cursor:pointer;transition:all .3s}.checklist li:hover{transform:translateX(5px);background:#e8e9ff}.checklist li.completed{background:#d4edda;border-left-color:#28a745}.checklist li.completed::before{content:"✅ ";margin-right:10px}table{width:100%;border-collapse:collapse;margin:20px 0}th,td{padding:15px;text-align:left;border-bottom:1px solid #ddd}th{background:#667eea;color:#fff}tr:hover{background:#f5f5f5}.highlight{background:#fff3cd;padding:3px 8px;border-radius:4px;font-weight:700}.btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;padding:15px 40px;border-radius:50px;font-size:1.1em;font-weight:700;cursor:pointer;transition:all .3s;display:inline-block;text-decoration:none}.btn-primary:hover{transform:translateY(-3px);box-shadow:0 15px 40px rgba(102,126,234,.4)}</style><div class=container><h1>🎯 Exness Email Tracking Setup</h1><p class=subtitle>Track user clicks by email for accurate postback matching</p><div class=warning-box><strong>⚠️ IMPORTANT:</strong> You need to run ONE SQL command in Supabase. Everything else is done automatically!</div><h2>📋 What You Need to Do (2 Minutes)</h2><div class=step><div class=step-title><span class=step-number>1</span>Go to Supabase SQL Editor</div><p>Open your Supabase dashboard:<br><a href="https://supabase.com/dashboard" target=_blank style=color:#667eea;font-weight:700>https://supabase.com/dashboard</a><ol style="margin-left:40px;margin-top:15px"><li>Select your project<li>Click <strong>SQL Editor</strong> in the left sidebar<li>Click <strong>New Query</strong></ol></div><div class=step><div class=step-title><span class=step-number>2</span>Copy and Run This SQL</div><div class=code-block><button class=copy-btn onclick="copyCode('sql1')">📋 Copy</button><pre id=sql1>-- Add email tracking to exness_clicks table
ALTER TABLE exness_clicks
ADD COLUMN IF NOT EXISTS user_email TEXT,
ADD COLUMN IF NOT EXISTS click_id TEXT UNIQUE;

-- Add indexes for fast lookups
CREATE INDEX IF NOT EXISTS idx_exness_clicks_email
ON exness_clicks(user_email, clicked_at DESC);

CREATE INDEX IF NOT EXISTS idx_exness_clicks_click_id
ON exness_clicks(click_id);

-- Add email to conversions table
ALTER TABLE exness_conversions
ADD COLUMN IF NOT EXISTS user_email TEXT;

CREATE INDEX IF NOT EXISTS idx_exness_conversions_email
ON exness_conversions(user_email);</pre></div><p style="margin-top:20px"><strong>Steps:</strong><ol style="margin-left:40px;margin-top:10px"><li>Paste the SQL above into the query editor<li>Click <strong>Run</strong> (or press Ctrl+Enter)<li>Wait for "Success" message<li>✅ Done!</ol></div><div class=step><div class=step-title><span class=step-number>3</span>Wait for Auto-Deploy</div><p>I'm deploying all code changes automatically. Render will rebuild in 2-3 minutes.<p style="margin-top:15px"><strong>What's being deployed:</strong><ul style="margin-left:40px;margin-top:10px"><li>✅ API updated to accept email parameter<li>✅ Popup updated to send user email<li>✅ Postback matching improved (email → IP → fallback)<li>✅ Conversion tracking includes email</ul></div><div class=success-box><strong>✅ That's It!</strong><br>You only need to run the SQL. Everything else is automatic!</div><h2>🔍 How It Works Now</h2><div class=flow-diagram><div class=flow-step><strong>1. User Clicks Popup</strong><br>✅ System saves: user_email + click_id + timestamp</div><div class=arrow>↓</div><div class=flow-step><strong>2. User Registers on Exness</strong><br>✅ Exness sends postback to your server</div><div class=arrow>↓</div><div class=flow-step><strong>3. Your Server Matches User</strong><br>✅ Searches by: email (best) → IP + time → fallback</div><div class=arrow>↓</div><div class=flow-step><strong>4. User Deposits $200+</strong><br>✅ Exness sends REWARD_PROCESSING postback</div><div class=arrow>↓</div><div class=flow-step><strong>5. User Auto-Approved!</strong><br>🎉 has_broker_account = true → Premium access unlocked!</div></div><h2>🧪 Testing (After Deploy)</h2><div class=step><h3>Test 1: Click Tracking</h3><ol style="margin-left:20px;margin-top:10px"><li>Log in to TradeFlow<li>Wait for 30-minute popup (or set timer to 1 min for testing)<li>Click "Claim Bonus" button<li>Open browser console (F12)<li>Should see: <span class=highlight>"✅ Click tracked: click_xxx"</span><li>Check Supabase <code>exness_clicks</code> table<li>Verify: Row exists with your email</ol></div><div class=step><h3>Test 2: Postback Matching</h3><div class=code-block><button class=copy-btn onclick="copyCode('test1')">📋 Copy</button><pre id=test1>curl -X POST https://tradeflow.blog/api/postback/exness \
  -H "Content-Type: application/json" \
  -H "X-Forwarded-For: YOUR_IP_ADDRESS" \
  -d '{
    "partner_id": "c_8f0nxidtbt",
    "event_type": "REWARD_PROCESSING",
    "user_id": "test_123"
  }'</pre></div><p style="margin-top:15px"><strong>Expected result:</strong><ul style="margin-left:40px;margin-top:10px"><li>Render logs: "✅ Matched by IP: YOUR_IP"<li>Supabase <code>users</code> table: has_broker_account = true<li>User can now access all premium features!</ul></div><h2>📊 What Changed</h2><table><thead><tr><th>Before<th>After<tbody><tr><td>❌ Only tracked in Google Analytics<td>✅ Tracked in database with email<tr><td>❌ Matched by IP only (unreliable)<td>✅ Matched by email → IP → fallback<tr><td>❌ Short time window (24h)<td>✅ Longer window (30 days)<tr><td>❌ Hard to debug issues<td>✅ Easy to search by email</table><h2>✅ Benefits</h2><div class=info-box><strong>More Reliable Matching:</strong><ul style="margin-left:20px;margin-top:10px"><li>Email is unique per user<li>Works even if IP changes<li>Works across different devices<li>Longer attribution window (30 days)</ul></div><div class=info-box><strong>Better Tracking:</strong><ul style="margin-left:20px;margin-top:10px"><li>Know exactly who clicked<li>Show users their click history<li>Better admin dashboard reporting<li>Clear audit trail for debugging</ul></div><h2>🔧 Admin: Check Click History</h2><p>To see all clicks for a user:<div class=code-block><button class=copy-btn onclick="copyCode('sql2')">📋 Copy</button><pre id=sql2>-- See all clicks for a user
SELECT
  user_email,
  click_url,
  clicked_at,
  ip_address,
  converted
FROM exness_clicks
WHERE user_email = 'user@example.com'
ORDER BY clicked_at DESC;

-- See all conversions for a user
SELECT
  user_email,
  event_type,
  ftd_amount,
  reward_amount,
  created_at
FROM exness_conversions
WHERE user_email = 'user@example.com'
ORDER BY created_at DESC;</pre></div><h2>🎯 Summary</h2><div class=success-box><strong>What You Did:</strong><ol style="margin-left:20px;margin-top:15px"><li>✅ Ran ONE SQL command in Supabase<li>✅ Waited for auto-deploy (2-3 min)</ol><strong style="display:block;margin-top:20px">What You Get:</strong><ul style="margin-left:20px;margin-top:10px"><li>✅ Reliable email-based tracking<li>✅ Accurate postback matching<li>✅ Users get auto-approved when they deposit<li>✅ Better attribution and reporting</ul><strong style="display:block;margin-top:20px">Next Steps:</strong><ul style="margin-left:20px;margin-top:10px"><li>🧪 Test the click tracking<li>🧪 Test postback with curl command<li>🚀 Launch Google Ads campaigns<li>📈 Monitor conversions in admin dashboard</ul></div><div style="text-align:center;margin-top:50px;padding-top:30px;border-top:2px solid #e2e8f0"><p style=color:#666>TradeFlow © 2025 | Exness Email Tracking System</p></div></div><script>function copyCode(id){const e=document.getElementById(id);navigator.clipboard.writeText(e.textContent).then(()=>{alert("✅ Copied to clipboard!")}).catch(e=>{alert("❌ Copy failed: "+e)})}document.querySelectorAll(".checklist li").forEach(e=>{e.addEventListener("click",function(){this.classList.toggle("completed")})})</script></html>
