<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCC Signal Pro - Implementation Guide for Beginners</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #1e293b;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 42px;
            font-weight: 900;
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 20px;
            color: #64748b;
            margin-bottom: 40px;
            font-weight: 500;
        }

        .hero-box {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 40px;
        }

        .hero-box h2 {
            font-size: 28px;
            margin-bottom: 15px;
        }

        .hero-box p {
            font-size: 18px;
            opacity: 0.95;
        }

        .toc {
            background: #f8fafc;
            border-left: 4px solid #3b82f6;
            padding: 20px 25px;
            margin-bottom: 40px;
            border-radius: 8px;
        }

        .toc h3 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #1e293b;
        }

        .toc ol {
            margin-left: 20px;
        }

        .toc a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .section {
            margin-bottom: 50px;
            scroll-margin-top: 20px;
        }

        h2 {
            font-size: 32px;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #e2e8f0;
        }

        h3 {
            font-size: 24px;
            font-weight: 700;
            color: #334155;
            margin: 30px 0 15px 0;
        }

        h4 {
            font-size: 18px;
            font-weight: 600;
            color: #475569;
            margin: 20px 0 10px 0;
        }

        p {
            margin-bottom: 15px;
            color: #475569;
            font-size: 16px;
        }

        .step-box {
            background: #f1f5f9;
            border-left: 4px solid #10b981;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .step-box h4 {
            color: #10b981;
            margin-top: 0;
            font-size: 18px;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .warning-box h4 {
            color: #d97706;
            margin-top: 0;
        }

        .info-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .info-box h4 {
            color: #2563eb;
            margin-top: 0;
        }

        .success-box {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .success-box h4 {
            color: #059669;
            margin-top: 0;
        }

        code {
            background: #f1f5f9;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #dc2626;
        }

        pre {
            background: #1e293b;
            color: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .command {
            background: #1e293b;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .command::before {
            content: "$ ";
            color: #3b82f6;
            font-weight: bold;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 10px;
            color: #475569;
        }

        .checklist {
            list-style: none;
            margin-left: 0;
        }

        .checklist li {
            padding-left: 30px;
            position: relative;
        }

        .checklist li::before {
            content: "‚òê";
            position: absolute;
            left: 0;
            font-size: 20px;
            color: #94a3b8;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }

        table th {
            background: #f1f5f9;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
        }

        table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            color: #475569;
        }

        table tr:hover {
            background: #f8fafc;
        }

        .button {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin: 10px 10px 10px 0;
            transition: transform 0.2s;
        }

        .button:hover {
            transform: translateY(-2px);
        }

        .button.secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .button.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .flowchart {
            background: #f8fafc;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: center;
        }

        .flow-step {
            display: inline-block;
            background: white;
            border: 2px solid #3b82f6;
            padding: 15px 25px;
            border-radius: 8px;
            margin: 10px;
            font-weight: 600;
            color: #1e293b;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .flow-arrow {
            display: inline-block;
            color: #3b82f6;
            font-size: 24px;
            margin: 0 10px;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
            margin: 30px 0;
        }

        .timeline::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #3b82f6 0%, #10b981 100%);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            padding-left: 30px;
        }

        .timeline-item::before {
            content: "";
            position: absolute;
            left: -46px;
            top: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            border: 4px solid white;
            box-shadow: 0 0 0 3px #dbeafe;
        }

        .timeline-item.completed::before {
            background: #10b981;
            box-shadow: 0 0 0 3px #d1fae5;
        }

        .metric-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid #e2e8f0;
        }

        .metric-card h4 {
            color: #1e293b;
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #64748b;
            font-size: 14px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #3b82f6;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.15);
        }

        .card h4 {
            color: #1e293b;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .emoji {
            font-size: 28px;
            margin-right: 10px;
        }

        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
                padding: 20px;
            }
            .button {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 32px;
            }
            h2 {
                font-size: 24px;
            }
            .grid-2 {
                grid-template-columns: 1fr;
            }
            .flow-step {
                display: block;
                margin: 10px 0;
            }
            .flow-arrow {
                display: block;
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ GCC Signal Pro Implementation Guide</h1>
        <p class="subtitle">Complete Step-by-Step Tutorial for Beginners</p>

        <div class="hero-box">
            <h2>üìã What We're Building</h2>
            <p><strong>Business Model:</strong> Users register with email ‚Üí Get 3 FREE signals/news ‚Üí To unlock unlimited access, they open an Exness account ($10 min deposit) ‚Üí They get premium access FREE forever (broker pays instead of users)</p>
            <p><strong>Your Benefit:</strong> Earn $250-500 per user who opens an Exness account + ongoing commissions from their trading</p>
        </div>

        <!-- Table of Contents -->
        <div class="toc">
            <h3>üìë Table of Contents</h3>
            <ol>
                <li><a href="#overview">System Overview</a></li>
                <li><a href="#prerequisites">Prerequisites & Setup</a></li>
                <li><a href="#database">Database Setup (Supabase)</a></li>
                <li><a href="#environment">Environment Variables</a></li>
                <li><a href="#dependencies">Install Dependencies</a></li>
                <li><a href="#auth-backend">Backend: Authentication API</a></li>
                <li><a href="#access-control">Backend: Access Control</a></li>
                <li><a href="#broker-api">Backend: Broker Verification</a></li>
                <li><a href="#frontend">Frontend: Components & UI</a></li>
                <li><a href="#email">Email System</a></li>
                <li><a href="#testing">Testing & Launch</a></li>
                <li><a href="#monitoring">Monitoring & Analytics</a></li>
            </ol>
        </div>

        <!-- Section 1: Overview -->
        <div class="section" id="overview">
            <h2>1Ô∏è‚É£ System Overview</h2>

            <div class="flowchart">
                <h3 style="margin-bottom: 20px;">User Journey Flow</h3>
                <div class="flow-step">New Visitor</div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">Register Email</div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">Verify Email</div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">View 3 Free Signals</div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">Hit Paywall</div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">Open Exness Account</div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">Verify Account</div>
                <span class="flow-arrow">‚Üí</span>
                <div class="flow-step">Unlimited Access!</div>
            </div>

            <h3>üéØ Key Features</h3>
            <div class="grid-2">
                <div class="card">
                    <h4><span class="emoji">üîê</span>Authentication System</h4>
                    <ul>
                        <li>Email + password registration</li>
                        <li>Email verification</li>
                        <li>Login/Logout</li>
                        <li>Password reset</li>
                    </ul>
                </div>

                <div class="card">
                    <h4><span class="emoji">üéÅ</span>Free Trial (3 Views)</h4>
                    <ul>
                        <li>Track views per user</li>
                        <li>Daily reset option</li>
                        <li>Visual counter</li>
                        <li>Smart paywall</li>
                    </ul>
                </div>

                <div class="card">
                    <h4><span class="emoji">üè¶</span>Broker Integration</h4>
                    <ul>
                        <li>Exness affiliate links</li>
                        <li>Account verification</li>
                        <li>Manual/automated approval</li>
                        <li>Commission tracking</li>
                    </ul>
                </div>

                <div class="card">
                    <h4><span class="emoji">üíé</span>Premium Access</h4>
                    <ul>
                        <li>Unlimited signals</li>
                        <li>All news & analysis</li>
                        <li>Education materials</li>
                        <li>Priority support</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Section 2: Prerequisites -->
        <div class="section" id="prerequisites">
            <h2>2Ô∏è‚É£ Prerequisites & Setup</h2>

            <div class="info-box">
                <h4>üìö What You Need to Know</h4>
                <p>Basic understanding of:</p>
                <ul>
                    <li>JavaScript/TypeScript</li>
                    <li>React basics</li>
                    <li>Next.js (we'll guide you!)</li>
                    <li>Command line/terminal</li>
                </ul>
                <p><strong>Don't worry!</strong> This guide assumes you're a beginner and explains everything.</p>
            </div>

            <h3>üõ†Ô∏è Tools You'll Need</h3>
            <ul class="checklist">
                <li>Node.js 18+ installed (<a href="https://nodejs.org" target="_blank">download here</a>)</li>
                <li>Code editor (VS Code recommended - <a href="https://code.visualstudio.com" target="_blank">download here</a>)</li>
                <li>Git installed (<a href="https://git-scm.com" target="_blank">download here</a>)</li>
                <li>Supabase account (free - <a href="https://supabase.com" target="_blank">sign up here</a>)</li>
                <li>Resend account for emails (free - <a href="https://resend.com" target="_blank">sign up here</a>)</li>
                <li>Exness affiliate account (<a href="https://www.exness.com/partners/" target="_blank">apply here</a>)</li>
            </ul>

            <div class="warning-box">
                <h4>‚ö†Ô∏è Important Note</h4>
                <p>Make sure your current project is backed up before starting. We'll be making significant changes to the codebase.</p>
                <div class="command">git add . && git commit -m "Backup before implementing auth system"</div>
            </div>
        </div>

        <!-- Section 3: Database Setup -->
        <div class="section" id="database">
            <h2>3Ô∏è‚É£ Database Setup (Supabase)</h2>

            <div class="step-box">
                <h4>Step 3.1: Create Supabase Project</h4>
                <ol>
                    <li>Go to <a href="https://supabase.com" target="_blank">supabase.com</a> and sign up</li>
                    <li>Click <strong>"New Project"</strong></li>
                    <li>Name it: <code>gcc-signal-pro</code></li>
                    <li>Choose a strong database password (save it!)</li>
                    <li>Select region closest to your users (e.g., Middle East)</li>
                    <li>Wait 2-3 minutes for setup to complete</li>
                </ol>
            </div>

            <div class="step-box">
                <h4>Step 3.2: Create Database Tables</h4>
                <ol>
                    <li>In Supabase dashboard, click <strong>"SQL Editor"</strong> in left menu</li>
                    <li>Click <strong>"+ New Query"</strong></li>
                    <li>Copy and paste this SQL code:</li>
                </ol>
            </div>

            <pre>-- ========================================
-- GCC SIGNAL PRO DATABASE SCHEMA
-- ========================================

-- 1. USERS TABLE
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  full_name VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  last_login TIMESTAMP,
  email_verified BOOLEAN DEFAULT FALSE,
  access_tier VARCHAR(50) DEFAULT 'free', -- 'free' or 'premium'
  free_views_count INT DEFAULT 0,
  free_views_reset_date DATE DEFAULT CURRENT_DATE,
  CONSTRAINT valid_email CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$')
);

-- 2. EMAIL VERIFICATION TOKENS
CREATE TABLE verification_tokens (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  token VARCHAR(255) UNIQUE NOT NULL,
  token_type VARCHAR(50) NOT NULL, -- 'email_verification' or 'password_reset'
  expires_at TIMESTAMP NOT NULL,
  used BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 3. BROKER ACCOUNTS
CREATE TABLE broker_accounts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE UNIQUE,
  broker_name VARCHAR(100) DEFAULT 'Exness',
  account_number VARCHAR(255),
  verification_status VARCHAR(50) DEFAULT 'pending', -- 'pending', 'verified', 'rejected'
  deposit_amount DECIMAL(10,2),
  submitted_at TIMESTAMP DEFAULT NOW(),
  verified_at TIMESTAMP,
  verified_by UUID REFERENCES users(id),
  affiliate_click_id VARCHAR(255),
  notes TEXT
);

-- 4. USER ACTIVITY LOG
CREATE TABLE user_activity (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  action_type VARCHAR(100) NOT NULL, -- 'view_signal', 'view_news', 'view_education'
  content_id VARCHAR(255),
  content_type VARCHAR(50),
  created_at TIMESTAMP DEFAULT NOW()
);

-- 5. ADMIN USERS (for verification dashboard)
CREATE TABLE admin_users (
  id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,
  role VARCHAR(50) DEFAULT 'admin', -- 'admin' or 'super_admin'
  created_at TIMESTAMP DEFAULT NOW()
);

-- ========================================
-- INDEXES FOR PERFORMANCE
-- ========================================

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_access_tier ON users(access_tier);
CREATE INDEX idx_broker_accounts_user_id ON broker_accounts(user_id);
CREATE INDEX idx_broker_accounts_status ON broker_accounts(verification_status);
CREATE INDEX idx_user_activity_user_id ON user_activity(user_id);
CREATE INDEX idx_user_activity_created_at ON user_activity(created_at);
CREATE INDEX idx_verification_tokens_token ON verification_tokens(token);
CREATE INDEX idx_verification_tokens_user_id ON verification_tokens(user_id);

-- ========================================
-- ROW LEVEL SECURITY (RLS) POLICIES
-- ========================================

-- Enable RLS on all tables
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE verification_tokens ENABLE ROW LEVEL SECURITY;
ALTER TABLE broker_accounts ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_activity ENABLE ROW LEVEL SECURITY;
ALTER TABLE admin_users ENABLE ROW LEVEL SECURITY;

-- Users can only read their own data
CREATE POLICY "Users can view own data" ON users
  FOR SELECT USING (auth.uid() = id);

-- Users can update their own data
CREATE POLICY "Users can update own data" ON users
  FOR UPDATE USING (auth.uid() = id);

-- Users can view their own broker accounts
CREATE POLICY "Users can view own broker account" ON broker_accounts
  FOR SELECT USING (auth.uid() = user_id);

-- Users can insert their own broker account
CREATE POLICY "Users can create own broker account" ON broker_accounts
  FOR INSERT WITH CHECK (auth.uid() = user_id);

-- Users can view their own activity
CREATE POLICY "Users can view own activity" ON user_activity
  FOR SELECT USING (auth.uid() = user_id);

-- ========================================
-- FUNCTIONS
-- ========================================

-- Function to reset free views daily
CREATE OR REPLACE FUNCTION reset_free_views_if_needed()
RETURNS void AS $$
BEGIN
  UPDATE users
  SET
    free_views_count = 0,
    free_views_reset_date = CURRENT_DATE
  WHERE
    free_views_reset_date < CURRENT_DATE
    AND access_tier = 'free';
END;
$$ LANGUAGE plpgsql;

-- Function to check if user can view content
CREATE OR REPLACE FUNCTION can_view_content(user_id_param UUID)
RETURNS BOOLEAN AS $$
DECLARE
  user_tier VARCHAR(50);
  user_views INT;
BEGIN
  SELECT access_tier, free_views_count INTO user_tier, user_views
  FROM users
  WHERE id = user_id_param;

  IF user_tier = 'premium' THEN
    RETURN TRUE;
  ELSIF user_tier = 'free' AND user_views < 3 THEN
    RETURN TRUE;
  ELSE
    RETURN FALSE;
  END IF;
END;
$$ LANGUAGE plpgsql;

-- ========================================
-- INITIAL ADMIN USER (CHANGE EMAIL!)
-- ========================================

-- Insert your admin user (you'll need to register this email first)
-- Then run this to make yourself admin:
-- INSERT INTO admin_users (id, role)
-- VALUES ((SELECT id FROM users WHERE email = 'your-email@example.com'), 'super_admin');

-- ========================================
-- DONE! üéâ
-- ========================================</pre>

            <div class="step-box">
                <h4>Step 3.3: Run the SQL Query</h4>
                <ol>
                    <li>Click <strong>"Run"</strong> button (bottom right)</li>
                    <li>You should see: "Success. No rows returned"</li>
                    <li>Go to <strong>"Table Editor"</strong> in left menu</li>
                    <li>Verify you see 5 tables: <code>users</code>, <code>verification_tokens</code>, <code>broker_accounts</code>, <code>user_activity</code>, <code>admin_users</code></li>
                </ol>
            </div>

            <div class="success-box">
                <h4>‚úÖ Database Setup Complete!</h4>
                <p>Your database is now ready. Next, we'll get the API keys.</p>
            </div>

            <div class="step-box">
                <h4>Step 3.4: Get Supabase API Keys</h4>
                <ol>
                    <li>In Supabase dashboard, click <strong>"Settings"</strong> (gear icon at bottom left)</li>
                    <li>Click <strong>"API"</strong> in the settings menu</li>
                    <li>You'll see two important keys:
                        <ul>
                            <li><strong>Project URL</strong> - looks like: <code>https://abcdefgh.supabase.co</code></li>
                            <li><strong>anon public key</strong> - long string starting with "eyJ..."</li>
                            <li><strong>service_role key</strong> - another long string (keep this SECRET!)</li>
                        </ul>
                    </li>
                    <li>Copy these - we'll use them in the next step</li>
                </ol>
            </div>
        </div>

        <!-- Section 4: Environment Variables -->
        <div class="section" id="environment">
            <h2>4Ô∏è‚É£ Environment Variables</h2>

            <div class="step-box">
                <h4>Step 4.1: Create .env.local File</h4>
                <ol>
                    <li>Open your project in VS Code</li>
                    <li>In the root folder, create a new file called <code>.env.local</code></li>
                    <li>Copy and paste this template:</li>
                </ol>
            </div>

            <pre># ========================================
# GCC SIGNAL PRO - ENVIRONMENT VARIABLES
# ========================================

# === SUPABASE DATABASE ===
# Get these from Supabase Dashboard ‚Üí Settings ‚Üí API
NEXT_PUBLIC_SUPABASE_URL="your-project-url.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY="your-anon-key-here"
SUPABASE_SERVICE_ROLE_KEY="your-service-role-key-here"

# === JWT AUTHENTICATION ===
# Generate a random secret: https://generate-secret.vercel.app/32
JWT_SECRET="your-super-secret-jwt-key-min-32-characters-long"
JWT_EXPIRES_IN="7d"

# === EMAIL SERVICE (RESEND) ===
# Get this from: https://resend.com/api-keys
RESEND_API_KEY="re_your_api_key_here"
EMAIL_FROM="GCC Signal Pro <noreply@yourdomain.com>"

# === EXNESS AFFILIATE ===
# Get your affiliate ID from Exness Partner Portal
EXNESS_AFFILIATE_ID="your-affiliate-id"
EXNESS_DESKTOP_LINK="https://one.exnessonelink.com/a/your-id"
EXNESS_MOBILE_LINK="https://one.exnessonelink.com/a/your-id?platform=mobile"

# === ACCESS CONTROL SETTINGS ===
FREE_TIER_LIMIT=3
FREE_TIER_RESET_HOURS=24
PREMIUM_MIN_DEPOSIT=10

# === APP SETTINGS ===
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NEXT_PUBLIC_APP_NAME="GCC Signal Pro"
NEXT_PUBLIC_SUPPORT_EMAIL="support@gccsignalpro.com"

# === OPENAI (Already configured) ===
OPENAI_API_KEY="sk-your-key-here"
OPENAI_MODEL="gpt-4o-mini"
OPENAI_MAX_TOKENS="3000"
OPENAI_TEMPERATURE="0.7"

# ========================================
# PRODUCTION NOTES:
# - Change NEXT_PUBLIC_APP_URL to your live URL
# - Never commit this file to Git!
# - Add these to Render environment variables
# ========================================</pre>

            <div class="step-box">
                <h4>Step 4.2: Fill in Your Values</h4>
                <p>Replace the placeholder values with your actual credentials:</p>

                <table>
                    <tr>
                        <th>Variable</th>
                        <th>Where to Get It</th>
                    </tr>
                    <tr>
                        <td><code>NEXT_PUBLIC_SUPABASE_URL</code></td>
                        <td>Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí Project URL</td>
                    </tr>
                    <tr>
                        <td><code>NEXT_PUBLIC_SUPABASE_ANON_KEY</code></td>
                        <td>Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí anon public</td>
                    </tr>
                    <tr>
                        <td><code>SUPABASE_SERVICE_ROLE_KEY</code></td>
                        <td>Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí service_role</td>
                    </tr>
                    <tr>
                        <td><code>JWT_SECRET</code></td>
                        <td>Generate: <a href="https://generate-secret.vercel.app/32" target="_blank">click here</a></td>
                    </tr>
                    <tr>
                        <td><code>RESEND_API_KEY</code></td>
                        <td>Resend Dashboard ‚Üí API Keys ‚Üí Create</td>
                    </tr>
                    <tr>
                        <td><code>EXNESS_AFFILIATE_ID</code></td>
                        <td>Exness Partner Portal ‚Üí Your Affiliate ID</td>
                    </tr>
                </table>
            </div>

            <div class="warning-box">
                <h4>üîí Security Important!</h4>
                <ul>
                    <li><strong>NEVER</strong> commit <code>.env.local</code> to Git</li>
                    <li>Make sure <code>.env.local</code> is in your <code>.gitignore</code> file</li>
                    <li>The <code>SUPABASE_SERVICE_ROLE_KEY</code> is super secret - it bypasses all security!</li>
                </ul>
            </div>

            <div class="step-box">
                <h4>Step 4.3: Verify .gitignore</h4>
                <p>Open <code>.gitignore</code> and make sure it includes:</p>
                <pre>.env.local
.env*.local
.env</pre>
            </div>
        </div>

        <!-- Section 5: Install Dependencies -->
        <div class="section" id="dependencies">
            <h2>5Ô∏è‚É£ Install Dependencies</h2>

            <div class="step-box">
                <h4>Step 5.1: Install Required Packages</h4>
                <p>Open your terminal in the project folder and run:</p>
            </div>

            <div class="command">npm install @supabase/supabase-js bcryptjs jsonwebtoken resend zod date-fns</div>

            <div class="command">npm install --save-dev @types/bcryptjs @types/jsonwebtoken</div>

            <div class="info-box">
                <h4>üì¶ What Each Package Does</h4>
                <ul>
                    <li><code>@supabase/supabase-js</code> - Connect to Supabase database</li>
                    <li><code>bcryptjs</code> - Securely hash passwords</li>
                    <li><code>jsonwebtoken</code> - Create login tokens (JWT)</li>
                    <li><code>resend</code> - Send emails easily</li>
                    <li><code>zod</code> - Validate user input</li>
                    <li><code>date-fns</code> - Work with dates easily</li>
                </ul>
            </div>

            <div class="success-box">
                <h4>‚úÖ Dependencies Installed!</h4>
                <p>Wait for installation to complete (30-60 seconds). You should see "added X packages".</p>
            </div>
        </div>

        <!-- Section 6: Auth Backend -->
        <div class="section" id="auth-backend">
            <h2>6Ô∏è‚É£ Backend: Authentication API</h2>

            <p>Now we'll create the API routes that handle registration, login, etc.</p>

            <h3>üìÅ Folder Structure</h3>
            <pre>src/app/api/
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ register/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ   ‚îú‚îÄ‚îÄ logout/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ   ‚îú‚îÄ‚îÄ verify-email/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ   ‚îú‚îÄ‚îÄ me/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ   ‚îî‚îÄ‚îÄ forgot-password/
‚îÇ       ‚îî‚îÄ‚îÄ route.ts
‚îî‚îÄ‚îÄ lib/
    ‚îú‚îÄ‚îÄ supabase.ts
    ‚îî‚îÄ‚îÄ auth.ts</pre>

            <div class="step-box">
                <h4>Step 6.1: Create Supabase Client</h4>
                <p>Create file: <code>src/lib/supabase.ts</code></p>
            </div>

            <pre>import { createClient } from '@supabase/supabase-js'

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!

// Create a Supabase client with service role for backend operations
export const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {
  auth: {
    autoRefreshToken: false,
    persistSession: false
  }
})

// Type for our user
export interface User {
  id: string
  email: string
  full_name: string | null
  access_tier: 'free' | 'premium'
  email_verified: boolean
  free_views_count: number
  free_views_reset_date: string
  created_at: string
}</pre>

            <div class="step-box">
                <h4>Step 6.2: Create Auth Helper Functions</h4>
                <p>Create file: <code>src/lib/auth.ts</code></p>
            </div>

            <pre>import bcrypt from 'bcryptjs'
import jwt from 'jsonwebtoken'
import { supabaseAdmin } from './supabase'

const JWT_SECRET = process.env.JWT_SECRET!
const JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || '7d'

// Hash password
export async function hashPassword(password: string): Promise<string> {
  return bcrypt.hash(password, 12)
}

// Verify password
export async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {
  return bcrypt.compare(password, hashedPassword)
}

// Generate JWT token
export function generateToken(userId: string, email: string): string {
  return jwt.sign(
    { userId, email },
    JWT_SECRET,
    { expiresIn: JWT_EXPIRES_IN }
  )
}

// Verify JWT token
export function verifyToken(token: string): { userId: string; email: string } | null {
  try {
    return jwt.verify(token, JWT_SECRET) as { userId: string; email: string }
  } catch {
    return null
  }
}

// Generate random verification token
export function generateVerificationToken(): string {
  return Math.random().toString(36).substring(2) + Date.now().toString(36)
}

// Get user from request token
export async function getUserFromRequest(request: Request) {
  const authHeader = request.headers.get('authorization')
  const token = authHeader?.replace('Bearer ', '')

  if (!token) {
    return null
  }

  const decoded = verifyToken(token)
  if (!decoded) {
    return null
  }

  const { data: user } = await supabaseAdmin
    .from('users')
    .select('*')
    .eq('id', decoded.userId)
    .single()

  return user
}</pre>

            <div class="step-box">
                <h4>Step 6.3: Create Register API Route</h4>
                <p>Create file: <code>src/app/api/auth/register/route.ts</code></p>
            </div>

            <pre>import { NextRequest, NextResponse } from 'next/server'
import { supabaseAdmin } from '@/lib/supabase'
import { hashPassword, generateVerificationToken } from '@/lib/auth'
import { z } from 'zod'

// Validation schema
const registerSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
  fullName: z.string().min(2, 'Name must be at least 2 characters').optional()
})

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()

    // Validate input
    const validation = registerSchema.safeParse(body)
    if (!validation.success) {
      return NextResponse.json(
        { error: validation.error.errors[0].message },
        { status: 400 }
      )
    }

    const { email, password, fullName } = validation.data

    // Check if user already exists
    const { data: existingUser } = await supabaseAdmin
      .from('users')
      .select('id')
      .eq('email', email.toLowerCase())
      .single()

    if (existingUser) {
      return NextResponse.json(
        { error: 'Email already registered' },
        { status: 400 }
      )
    }

    // Hash password
    const passwordHash = await hashPassword(password)

    // Create user
    const { data: newUser, error: userError } = await supabaseAdmin
      .from('users')
      .insert({
        email: email.toLowerCase(),
        password_hash: passwordHash,
        full_name: fullName || null,
        access_tier: 'free',
        email_verified: false,
        free_views_count: 0
      })
      .select()
      .single()

    if (userError) {
      console.error('Error creating user:', userError)
      return NextResponse.json(
        { error: 'Failed to create account' },
        { status: 500 }
      )
    }

    // Generate verification token
    const verificationToken = generateVerificationToken()
    const expiresAt = new Date()
    expiresAt.setHours(expiresAt.getHours() + 24) // 24 hour expiry

    await supabaseAdmin
      .from('verification_tokens')
      .insert({
        user_id: newUser.id,
        token: verificationToken,
        token_type: 'email_verification',
        expires_at: expiresAt.toISOString()
      })

    // TODO: Send verification email (we'll implement this in the email section)
    const verificationUrl = `${process.env.NEXT_PUBLIC_APP_URL}/verify-email?token=${verificationToken}`
    console.log('Verification URL:', verificationUrl)

    return NextResponse.json({
      success: true,
      message: 'Account created! Please check your email to verify.',
      userId: newUser.id,
      // In development, return the verification URL
      ...(process.env.NODE_ENV === 'development' && { verificationUrl })
    })

  } catch (error: any) {
    console.error('Registration error:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}</pre>

            <div class="step-box">
                <h4>Step 6.4: Create Login API Route</h4>
                <p>Create file: <code>src/app/api/auth/login/route.ts</code></p>
            </div>

            <pre>import { NextRequest, NextResponse } from 'next/server'
import { supabaseAdmin } from '@/lib/supabase'
import { verifyPassword, generateToken } from '@/lib/auth'
import { z } from 'zod'

const loginSchema = z.object({
  email: z.string().email(),
  password: z.string().min(1)
})

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()

    const validation = loginSchema.safeParse(body)
    if (!validation.success) {
      return NextResponse.json(
        { error: 'Invalid email or password' },
        { status: 400 }
      )
    }

    const { email, password } = validation.data

    // Get user from database
    const { data: user, error } = await supabaseAdmin
      .from('users')
      .select('*')
      .eq('email', email.toLowerCase())
      .single()

    if (error || !user) {
      return NextResponse.json(
        { error: 'Invalid email or password' },
        { status: 401 }
      )
    }

    // Verify password
    const isValidPassword = await verifyPassword(password, user.password_hash)
    if (!isValidPassword) {
      return NextResponse.json(
        { error: 'Invalid email or password' },
        { status: 401 }
      )
    }

    // Update last login
    await supabaseAdmin
      .from('users')
      .update({ last_login: new Date().toISOString() })
      .eq('id', user.id)

    // Generate JWT token
    const token = generateToken(user.id, user.email)

    // Return user data (without password hash)
    const { password_hash, ...userData } = user

    return NextResponse.json({
      success: true,
      token,
      user: userData
    })

  } catch (error) {
    console.error('Login error:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}</pre>

            <div class="step-box">
                <h4>Step 6.5: Create Verify Email Route</h4>
                <p>Create file: <code>src/app/api/auth/verify-email/route.ts</code></p>
            </div>

            <pre>import { NextRequest, NextResponse } from 'next/server'
import { supabaseAdmin } from '@/lib/supabase'

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url)
    const token = searchParams.get('token')

    if (!token) {
      return NextResponse.json(
        { error: 'Verification token required' },
        { status: 400 }
      )
    }

    // Find token
    const { data: tokenData, error: tokenError } = await supabaseAdmin
      .from('verification_tokens')
      .select('*')
      .eq('token', token)
      .eq('token_type', 'email_verification')
      .eq('used', false)
      .single()

    if (tokenError || !tokenData) {
      return NextResponse.json(
        { error: 'Invalid or expired verification token' },
        { status: 400 }
      )
    }

    // Check if expired
    if (new Date(tokenData.expires_at) < new Date()) {
      return NextResponse.json(
        { error: 'Verification token has expired' },
        { status: 400 }
      )
    }

    // Mark user as verified
    const { error: updateError } = await supabaseAdmin
      .from('users')
      .update({ email_verified: true })
      .eq('id', tokenData.user_id)

    if (updateError) {
      throw updateError
    }

    // Mark token as used
    await supabaseAdmin
      .from('verification_tokens')
      .update({ used: true })
      .eq('id', tokenData.id)

    return NextResponse.json({
      success: true,
      message: 'Email verified successfully!'
    })

  } catch (error) {
    console.error('Email verification error:', error)
    return NextResponse.json(
      { error: 'Failed to verify email' },
      { status: 500 }
    )
  }
}</pre>

            <div class="step-box">
                <h4>Step 6.6: Create "Get Current User" Route</h4>
                <p>Create file: <code>src/app/api/auth/me/route.ts</code></p>
            </div>

            <pre>import { NextRequest, NextResponse } from 'next/server'
import { getUserFromRequest } from '@/lib/auth'

export async function GET(request: NextRequest) {
  try {
    const user = await getUserFromRequest(request)

    if (!user) {
      return NextResponse.json(
        { error: 'Not authenticated' },
        { status: 401 }
      )
    }

    // Remove sensitive data
    const { password_hash, ...userData } = user

    return NextResponse.json({
      success: true,
      user: userData
    })

  } catch (error) {
    console.error('Get user error:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}</pre>

            <div class="success-box">
                <h4>‚úÖ Authentication Backend Complete!</h4>
                <p>You now have working registration, login, and email verification APIs.</p>
            </div>
        </div>

        <!-- Section 7: Access Control -->
        <div class="section" id="access-control">
            <h2>7Ô∏è‚É£ Backend: Access Control System</h2>

            <p>This system tracks how many free views users have used and shows the paywall.</p>

            <div class="step-box">
                <h4>Step 7.1: Create Access Control Helper</h4>
                <p>Create file: <code>src/lib/access-control.ts</code></p>
            </div>

            <pre>import { supabaseAdmin, User } from './supabase'

const FREE_TIER_LIMIT = parseInt(process.env.FREE_TIER_LIMIT || '3')

export async function canViewContent(userId: string): Promise<{
  canView: boolean
  viewsRemaining: number
  reason?: string
}> {
  try {
    // Get user
    const { data: user, error } = await supabaseAdmin
      .from('users')
      .select('*')
      .eq('id', userId)
      .single()

    if (error || !user) {
      return { canView: false, viewsRemaining: 0, reason: 'User not found' }
    }

    // Check if email is verified
    if (!user.email_verified) {
      return { canView: false, viewsRemaining: 0, reason: 'Email not verified' }
    }

    // Premium users get unlimited access
    if (user.access_tier === 'premium') {
      return { canView: true, viewsRemaining: -1 } // -1 means unlimited
    }

    // Reset views if needed (new day)
    const today = new Date().toISOString().split('T')[0]
    const resetDate = user.free_views_reset_date

    if (resetDate !== today) {
      // Reset the counter
      await supabaseAdmin
        .from('users')
        .update({
          free_views_count: 0,
          free_views_reset_date: today
        })
        .eq('id', userId)

      return { canView: true, viewsRemaining: FREE_TIER_LIMIT - 1 }
    }

    // Check free tier limit
    const viewsUsed = user.free_views_count
    const viewsRemaining = FREE_TIER_LIMIT - viewsUsed

    if (viewsUsed >= FREE_TIER_LIMIT) {
      return {
        canView: false,
        viewsRemaining: 0,
        reason: 'Free limit reached. Upgrade to continue.'
      }
    }

    return { canView: true, viewsRemaining }

  } catch (error) {
    console.error('Access control error:', error)
    return { canView: false, viewsRemaining: 0, reason: 'Error checking access' }
  }
}

export async function recordView(
  userId: string,
  contentType: 'signal' | 'news' | 'education' | 'analysis',
  contentId: string
): Promise<void> {
  try {
    // Get user
    const { data: user } = await supabaseAdmin
      .from('users')
      .select('access_tier, free_views_count')
      .eq('id', userId)
      .single()

    if (!user) return

    // Don't count views for premium users
    if (user.access_tier === 'premium') {
      // Still log the activity for analytics
      await supabaseAdmin.from('user_activity').insert({
        user_id: userId,
        action_type: `view_${contentType}`,
        content_id: contentId,
        content_type: contentType
      })
      return
    }

    // Increment free view count
    await supabaseAdmin
      .from('users')
      .update({
        free_views_count: user.free_views_count + 1
      })
      .eq('id', userId)

    // Log activity
    await supabaseAdmin.from('user_activity').insert({
      user_id: userId,
      action_type: `view_${contentType}`,
      content_id: contentId,
      content_type: contentType
    })

  } catch (error) {
    console.error('Record view error:', error)
  }
}

export async function getUserStats(userId: string) {
  const { data: user } = await supabaseAdmin
    .from('users')
    .select('access_tier, free_views_count, free_views_reset_date')
    .eq('id', userId)
    .single()

  if (!user) return null

  const viewsRemaining = user.access_tier === 'premium'
    ? -1
    : Math.max(0, FREE_TIER_LIMIT - user.free_views_count)

  return {
    accessTier: user.access_tier,
    viewsUsed: user.free_views_count,
    viewsRemaining,
    resetDate: user.free_views_reset_date,
    isPremium: user.access_tier === 'premium'
  }
}</pre>

            <div class="step-box">
                <h4>Step 7.2: Update Signals API with Access Control</h4>
                <p>Modify file: <code>src/app/api/generate-signals/route.ts</code></p>
                <p>Add this at the top after imports:</p>
            </div>

            <pre>import { getUserFromRequest } from '@/lib/auth'
import { canViewContent, recordView } from '@/lib/access-control'

export async function POST(request: NextRequest) {
  try {
    // üîê CHECK AUTHENTICATION
    const user = await getUserFromRequest(request)

    if (!user) {
      return NextResponse.json(
        {
          error: 'Please login to view signals',
          requiresAuth: true
        },
        { status: 401 }
      )
    }

    // üéÅ CHECK ACCESS (Free/Premium)
    const accessCheck = await canViewContent(user.id)

    if (!accessCheck.canView) {
      return NextResponse.json({
        error: accessCheck.reason,
        requiresUpgrade: true,
        viewsRemaining: 0
      }, { status: 403 })
    }

    // ... rest of your existing signal generation code ...

    // After generating signals successfully, record the view
    await recordView(user.id, 'signal', 'daily-signals')

    // Add access info to response
    return NextResponse.json({
      success: true,
      signals: enrichedSignals,
      // ... your existing response ...
      accessInfo: {
        viewsRemaining: accessCheck.viewsRemaining,
        isPremium: user.access_tier === 'premium'
      }
    })

  } catch (error: any) {
    // ... your existing error handling ...
  }
}</pre>

            <div class="info-box">
                <h4>üìù What This Does</h4>
                <ol>
                    <li>Checks if user is logged in</li>
                    <li>Checks if user has views remaining</li>
                    <li>Generates signals if allowed</li>
                    <li>Records the view in database</li>
                    <li>Returns remaining views count</li>
                </ol>
            </div>

            <div class="step-box">
                <h4>Step 7.3: Create Check Access API Route</h4>
                <p>Create file: <code>src/app/api/auth/check-access/route.ts</code></p>
            </div>

            <pre>import { NextRequest, NextResponse } from 'next/server'
import { getUserFromRequest } from '@/lib/auth'
import { getUserStats } from '@/lib/access-control'

export async function GET(request: NextRequest) {
  try {
    const user = await getUserFromRequest(request)

    if (!user) {
      return NextResponse.json(
        { error: 'Not authenticated' },
        { status: 401 }
      )
    }

    const stats = await getUserStats(user.id)

    return NextResponse.json({
      success: true,
      ...stats
    })

  } catch (error) {
    console.error('Check access error:', error)
    return NextResponse.json(
      { error: 'Failed to check access' },
      { status: 500 }
    )
  }
}</pre>

            <div class="success-box">
                <h4>‚úÖ Access Control Complete!</h4>
                <p>Your API now tracks free views and enforces the 3-view limit.</p>
            </div>
        </div>

        <!-- Section 8: Broker Integration -->
        <div class="section" id="broker-api">
            <h2>8Ô∏è‚É£ Backend: Broker Verification System</h2>

            <div class="step-box">
                <h4>Step 8.1: Create Broker Submit Route</h4>
                <p>Create file: <code>src/app/api/broker/submit-account/route.ts</code></p>
            </div>

            <pre>import { NextRequest, NextResponse } from 'next/server'
import { getUserFromRequest } from '@/lib/auth'
import { supabaseAdmin } from '@/lib/supabase'
import { z } from 'zod'

const submitSchema = z.object({
  accountNumber: z.string().min(3, 'Account number required'),
  depositAmount: z.number().min(10, 'Minimum deposit is $10').optional(),
  affiliateClickId: z.string().optional()
})

export async function POST(request: NextRequest) {
  try {
    const user = await getUserFromRequest(request)

    if (!user) {
      return NextResponse.json(
        { error: 'Not authenticated' },
        { status: 401 }
      )
    }

    const body = await request.json()
    const validation = submitSchema.safeParse(body)

    if (!validation.success) {
      return NextResponse.json(
        { error: validation.error.errors[0].message },
        { status: 400 }
      )
    }

    const { accountNumber, depositAmount, affiliateClickId } = validation.data

    // Check if user already submitted
    const { data: existing } = await supabaseAdmin
      .from('broker_accounts')
      .select('id, verification_status')
      .eq('user_id', user.id)
      .single()

    if (existing) {
      if (existing.verification_status === 'verified') {
        return NextResponse.json(
          { error: 'Your account is already verified' },
          { status: 400 }
        )
      }

      // Update existing submission
      const { error: updateError } = await supabaseAdmin
        .from('broker_accounts')
        .update({
          account_number: accountNumber,
          deposit_amount: depositAmount,
          affiliate_click_id: affiliateClickId,
          submitted_at: new Date().toISOString(),
          verification_status: 'pending'
        })
        .eq('id', existing.id)

      if (updateError) throw updateError

      return NextResponse.json({
        success: true,
        message: 'Account updated. We will verify it within 24 hours.'
      })
    }

    // Create new submission
    const { error: insertError } = await supabaseAdmin
      .from('broker_accounts')
      .insert({
        user_id: user.id,
        broker_name: 'Exness',
        account_number: accountNumber,
        deposit_amount: depositAmount,
        affiliate_click_id: affiliateClickId,
        verification_status: 'pending'
      })

    if (insertError) throw insertError

    // TODO: Send notification email to admin

    return NextResponse.json({
      success: true,
      message: 'Account submitted! We will verify it within 24 hours and notify you by email.'
    })

  } catch (error) {
    console.error('Submit broker account error:', error)
    return NextResponse.json(
      { error: 'Failed to submit account' },
      { status: 500 }
    )
  }
}</pre>

            <div class="step-box">
                <h4>Step 8.2: Create Check Status Route</h4>
                <p>Create file: <code>src/app/api/broker/check-status/route.ts</code></p>
            </div>

            <pre>import { NextRequest, NextResponse } from 'next/server'
import { getUserFromRequest } from '@/lib/auth'
import { supabaseAdmin } from '@/lib/supabase'

export async function GET(request: NextRequest) {
  try {
    const user = await getUserFromRequest(request)

    if (!user) {
      return NextResponse.json(
        { error: 'Not authenticated' },
        { status: 401 }
      )
    }

    const { data: brokerAccount } = await supabaseAdmin
      .from('broker_accounts')
      .select('*')
      .eq('user_id', user.id)
      .single()

    if (!brokerAccount) {
      return NextResponse.json({
        success: true,
        status: 'not_submitted',
        message: 'No broker account submitted yet'
      })
    }

    return NextResponse.json({
      success: true,
      status: brokerAccount.verification_status,
      accountNumber: brokerAccount.account_number,
      submittedAt: brokerAccount.submitted_at,
      verifiedAt: brokerAccount.verified_at,
      notes: brokerAccount.notes
    })

  } catch (error) {
    console.error('Check broker status error:', error)
    return NextResponse.json(
      { error: 'Failed to check status' },
      { status: 500 }
    )
  }
}</pre>

            <div class="step-box">
                <h4>Step 8.3: Create Admin Approval Route</h4>
                <p>Create file: <code>src/app/api/broker/verify/route.ts</code></p>
            </div>

            <pre>import { NextRequest, NextResponse } from 'next/server'
import { getUserFromRequest } from '@/lib/auth'
import { supabaseAdmin } from '@/lib/supabase'

export async function POST(request: NextRequest) {
  try {
    const admin = await getUserFromRequest(request)

    if (!admin) {
      return NextResponse.json(
        { error: 'Not authenticated' },
        { status: 401 }
      )
    }

    // Check if user is admin
    const { data: adminCheck } = await supabaseAdmin
      .from('admin_users')
      .select('id')
      .eq('id', admin.id)
      .single()

    if (!adminCheck) {
      return NextResponse.json(
        { error: 'Admin access required' },
        { status: 403 }
      )
    }

    const { brokerAccountId, action, notes } = await request.json()

    if (!['approve', 'reject'].includes(action)) {
      return NextResponse.json(
        { error: 'Invalid action' },
        { status: 400 }
      )
    }

    // Get broker account
    const { data: brokerAccount } = await supabaseAdmin
      .from('broker_accounts')
      .select('user_id')
      .eq('id', brokerAccountId)
      .single()

    if (!brokerAccount) {
      return NextResponse.json(
        { error: 'Broker account not found' },
        { status: 404 }
      )
    }

    if (action === 'approve') {
      // Approve: Upgrade user to premium
      await supabaseAdmin
        .from('users')
        .update({ access_tier: 'premium' })
        .eq('id', brokerAccount.user_id)

      // Update broker account
      await supabaseAdmin
        .from('broker_accounts')
        .update({
          verification_status: 'verified',
          verified_at: new Date().toISOString(),
          verified_by: admin.id,
          notes: notes || null
        })
        .eq('id', brokerAccountId)

      // TODO: Send congratulations email

      return NextResponse.json({
        success: true,
        message: 'Account approved and user upgraded to premium!'
      })
    } else {
      // Reject
      await supabaseAdmin
        .from('broker_accounts')
        .update({
          verification_status: 'rejected',
          notes: notes || null
        })
        .eq('id', brokerAccountId)

      // TODO: Send rejection email with reason

      return NextResponse.json({
        success: true,
        message: 'Account rejected'
      })
    }

  } catch (error) {
    console.error('Verify broker error:', error)
    return NextResponse.json(
      { error: 'Failed to verify account' },
      { status: 500 }
    )
  }
}</pre>

            <div class="success-box">
                <h4>‚úÖ Broker Verification Backend Complete!</h4>
                <p>Users can now submit their Exness accounts for verification.</p>
            </div>
        </div>

        <!-- Continue with more sections... -->

        <div class="section" id="frontend">
            <h2>9Ô∏è‚É£ Frontend: React Components & UI</h2>

            <div class="info-box">
                <h4>üé® What We're Building</h4>
                <p>Now we'll create the user interface components that your users will interact with:</p>
                <ul>
                    <li>Login/Register modals</li>
                    <li>Paywall popup after 3 views</li>
                    <li>Free trial counter</li>
                    <li>Broker account submission form</li>
                </ul>
            </div>

            <h3>Component Structure</h3>
            <pre>src/components/
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ LoginModal.tsx
‚îÇ   ‚îú‚îÄ‚îÄ RegisterModal.tsx
‚îÇ   ‚îî‚îÄ‚îÄ AuthButton.tsx
‚îú‚îÄ‚îÄ paywall/
‚îÇ   ‚îú‚îÄ‚îÄ PaywallModal.tsx
‚îÇ   ‚îî‚îÄ‚îÄ FreeTrialBanner.tsx
‚îî‚îÄ‚îÄ broker/
    ‚îî‚îÄ‚îÄ BrokerVerificationModal.tsx</pre>

            <div class="warning-box">
                <h4>‚ö†Ô∏è Important: Creating Components Folder</h4>
                <p>First, create the <code>src/components</code> folder structure:</p>
                <div class="command">mkdir -p src/components/auth src/components/paywall src/components/broker</div>
            </div>

            <p style="margin-top: 30px;"><strong>Due to length limitations, I'm providing the key integration points in your existing page.tsx:</strong></p>

            <h3>Key Changes to src/app/page.tsx</h3>

            <div class="step-box">
                <h4>Step 9.1: Add Authentication State</h4>
                <p>Add these state variables at the top of your HomePage component:</p>
            </div>

            <pre>// Add to your existing state declarations
const [isAuthenticated, setIsAuthenticated] = useState(false)
const [currentUser, setCurrentUser] = useState&lt;any&gt;(null)
const [authToken, setAuthToken] = useState&lt;string | null&gt;(null)
const [showLoginModal, setShowLoginModal] = useState(false)
const [showRegisterModal, setShowRegisterModal] = useState(false)
const [showPaywall, setShowPaywall] = useState(false)
const [showBrokerModal, setShowBrokerModal] = useState(false)
const [accessInfo, setAccessInfo] = useState({
  isPremium: false,
  viewsRemaining: 3,
  viewsUsed: 0
})</pre>

            <div class="step-box">
                <h4>Step 9.2: Add Authentication Check on Load</h4>
                <p>Add this useEffect to check if user is logged in:</p>
            </div>

            <pre>useEffect(() => {
  // Check if user has auth token in localStorage
  const token = localStorage.getItem('auth_token')
  const user = localStorage.getItem('user_data')

  if (token && user) {
    setAuthToken(token)
    setCurrentUser(JSON.parse(user))
    setIsAuthenticated(true)

    // Fetch latest user info
    fetchUserInfo(token)
  }
}, [])

async function fetchUserInfo(token: string) {
  try {
    const response = await fetch('/api/auth/me', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    })

    if (response.ok) {
      const data = await response.json()
      setCurrentUser(data.user)

      // Get access info
      const accessResponse = await fetch('/api/auth/check-access', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      if (accessResponse.ok) {
        const accessData = await accessResponse.json()
        setAccessInfo({
          isPremium: accessData.isPremium,
          viewsRemaining: accessData.viewsRemaining,
          viewsUsed: accessData.viewsUsed
        })
      }
    } else {
      // Token invalid, clear it
      handleLogout()
    }
  } catch (error) {
    console.error('Failed to fetch user info:', error)
  }
}

function handleLogout() {
  localStorage.removeItem('auth_token')
  localStorage.removeItem('user_data')
  setAuthToken(null)
  setCurrentUser(null)
  setIsAuthenticated(false)
  setAccessInfo({
    isPremium: false,
    viewsRemaining: 3,
    viewsUsed: 0
  })
}</pre>

            <div class="step-box">
                <h4>Step 9.3: Update fetchAISignals Function</h4>
                <p>Modify your existing signal fetching to include auth:</p>
            </div>

            <pre>const fetchAISignals = async () => {
  // Check authentication first
  if (!isAuthenticated) {
    addNotification('Please login to view signals', 'warning')
    setShowLoginModal(true)
    return
  }

  setIsLoadingSignals(true)
  setSignalsError(null)

  try {
    const response = await fetch('/api/generate-signals', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      }
    })

    const data = await response.json()

    if (!response.ok) {
      // Handle different error types
      if (data.requiresAuth) {
        setShowLoginModal(true)
        throw new Error('Please login to continue')
      }

      if (data.requiresUpgrade) {
        setShowPaywall(true)
        throw new Error('Upgrade to view more signals')
      }

      throw new Error(data.error || 'Failed to generate signals')
    }

    if (data.success && data.signals) {
      setAiSignals(data.signals)

      // Update access info
      if (data.accessInfo) {
        setAccessInfo(prev => ({
          ...prev,
          viewsRemaining: data.accessInfo.viewsRemaining,
          isPremium: data.accessInfo.isPremium
        }))

        // Show paywall if this was the last free view
        if (data.accessInfo.viewsRemaining === 0 && !data.accessInfo.isPremium) {
          setTimeout(() => setShowPaywall(true), 2000)
        }
      }
    }

  } catch (error: any) {
    setSignalsError(error.message)
    addNotification(error.message, 'warning')
  } finally {
    setIsLoadingSignals(false)
  }
}</pre>

            <div class="step-box">
                <h4>Step 9.4: Add Login/Register UI in Header</h4>
                <p>Replace the notification bell section with this enhanced header:</p>
            </div>

            <pre>          <div style={{ display: 'flex', gap: '16px', alignItems: 'center' }}>
            {/* Free Trial Counter - Show for free users */}
            {isAuthenticated && !accessInfo.isPremium && (
              <div style={{
                background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',
                padding: '8px 16px',
                borderRadius: '12px',
                fontSize: '14px',
                fontWeight: '600',
                color: '#92400e',
                border: '1px solid #fbbf24'
              }}>
                üéÅ {accessInfo.viewsRemaining} free views left
              </div>
            )}

            {/* Premium Badge */}
            {isAuthenticated && accessInfo.isPremium && (
              <div style={{
                background: 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)',
                padding: '8px 16px',
                borderRadius: '12px',
                fontSize: '14px',
                fontWeight: '700',
                color: '#1e293b',
                boxShadow: '0 4px 12px rgba(251, 191, 36, 0.4)'
              }}>
                üíé PREMIUM
              </div>
            )}

            {/* Notification Bell */}
            <div style={{ position: 'relative' }}>
              <button style={{
                background: 'linear-gradient(135deg, #334155 0%, #1e293b 100%)',
                border: 'none',
                color: '#f8fafc',
                padding: '10px 14px',
                borderRadius: '12px',
                cursor: 'pointer',
                fontSize: '18px',
                boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',
                transition: 'all 0.3s ease'
              }}>
                üîî
              </button>
              {notifications.length > 0 && (
                <div style={{
                  position: 'absolute',
                  top: '-4px',
                  right: '-4px',
                  background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
                  color: 'white',
                  borderRadius: '50%',
                  width: '20px',
                  height: '20px',
                  fontSize: '11px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontWeight: '700'
                }}>
                  {notifications.length}
                </div>
              )}
            </div>

            {/* Auth Buttons */}
            {!isAuthenticated ? (
              <>
                <button
                  onClick={() => setShowLoginModal(true)}
                  style={{
                    background: 'transparent',
                    border: '2px solid #3b82f6',
                    color: '#3b82f6',
                    padding: '8px 20px',
                    borderRadius: '12px',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: 'pointer',
                    transition: 'all 0.3s ease'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = '#3b82f6'
                    e.currentTarget.style.color = 'white'
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = 'transparent'
                    e.currentTarget.style.color = '#3b82f6'
                  }}
                >
                  Login
                </button>

                <button
                  onClick={() => setShowRegisterModal(true)}
                  style={{
                    background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',
                    border: 'none',
                    color: 'white',
                    padding: '10px 24px',
                    borderRadius: '12px',
                    fontSize: '15px',
                    fontWeight: '700',
                    cursor: 'pointer',
                    boxShadow: '0 4px 12px rgba(59, 130, 246, 0.4)',
                    transition: 'all 0.3s ease'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.transform = 'translateY(-2px)'
                    e.currentTarget.style.boxShadow = '0 6px 20px rgba(59, 130, 246, 0.6)'
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.transform = 'translateY(0)'
                    e.currentTarget.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.4)'
                  }}
                >
                  Sign Up Free
                </button>
              </>
            ) : (
              <div style={{ position: 'relative' }}>
                <button
                  style={{
                    background: 'linear-gradient(135deg, #334155 0%, #1e293b 100%)',
                    border: 'none',
                    color: '#f8fafc',
                    padding: '10px 18px',
                    borderRadius: '12px',
                    fontSize: '14px',
                    fontWeight: '600',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px'
                  }}
                >
                  üë§ {currentUser?.full_name || currentUser?.email?.split('@')[0] || 'Account'}
                  <span style={{ fontSize: '12px' }}>‚ñº</span>
                </button>
                {/* TODO: Add dropdown menu with Logout, Profile, etc. */}
              </div>
            )}
          </div></pre>

            <div class="success-box">
                <h4>‚úÖ Frontend Integration Started!</h4>
                <p>You now have:</p>
                <ul>
                    <li>Authentication state management</li>
                    <li>Login/Register buttons in header</li>
                    <li>Free trial counter display</li>
                    <li>Premium badge for upgraded users</li>
                </ul>
                <p><strong>Next:</strong> You'll need to create the actual modal components for Login, Register, Paywall, etc.</p>
            </div>

            <div class="info-box">
                <h4>üì¶ Complete Component Code Available</h4>
                <p>Due to the length of this guide, I've included the backend integration. For the complete modal components (LoginModal, RegisterModal, PaywallModal, BrokerVerificationModal), these would be separate React components you can build following these patterns:</p>
                <ul>
                    <li>Use controlled form inputs with useState</li>
                    <li>Validate input before submitting</li>
                    <li>Call the API endpoints we created</li>
                    <li>Handle success/error responses</li>
                    <li>Update parent component state</li>
                </ul>
                <p><strong>Ready to implement?</strong> Let me know and I can provide the complete modal components next!</p>
            </div>
        </div>

        <!-- Email System -->
        <div class="section" id="email">
            <h2>üîü Email System Setup</h2>

            <div class="step-box">
                <h4>Step 10.1: Sign Up for Resend</h4>
                <ol>
                    <li>Go to <a href="https://resend.com" target="_blank">resend.com</a> and sign up</li>
                    <li>Verify your email</li>
                    <li>Go to <strong>API Keys</strong> in dashboard</li>
                    <li>Click <strong>Create API Key</strong></li>
                    <li>Name it "GCC Signal Pro Production"</li>
                    <li>Copy the key (starts with <code>re_</code>)</li>
                    <li>Add to your <code>.env.local</code>: <code>RESEND_API_KEY="re_your_key"</code></li>
                </ol>
            </div>

            <div class="step-box">
                <h4>Step 10.2: Add Domain (Optional but Recommended)</h4>
                <ol>
                    <li>In Resend dashboard, go to <strong>Domains</strong></li>
                    <li>Click <strong>Add Domain</strong></li>
                    <li>Enter your domain: <code>yourdomain.com</code></li>
                    <li>Follow DNS setup instructions</li>
                    <li>Verify domain (may take up to 48 hours)</li>
                </ol>
                <p><strong>Without custom domain:</strong> Emails will be sent from <code>onboarding@resend.dev</code> (free tier)</p>
            </div>

            <div class="step-box">
                <h4>Step 10.3: Create Email Service</h4>
                <p>Create file: <code>src/lib/email.ts</code></p>
            </div>

            <pre>import { Resend } from 'resend'

const resend = new Resend(process.env.RESEND_API_KEY)
const fromEmail = process.env.EMAIL_FROM || 'GCC Signal Pro <noreply@yourdomain.com>'
const appUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'

export async function sendVerificationEmail(
  email: string,
  name: string,
  verificationToken: string
) {
  const verificationUrl = `${appUrl}/verify-email?token=${verificationToken}`

  try {
    await resend.emails.send({
      from: fromEmail,
      to: email,
      subject: 'Welcome to GCC Signal Pro! üéâ Verify Your Email',
      html: `
        <!DOCTYPE html>
        <html>
        <head>
          <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }
            .header h1 { color: white; margin: 0; font-size: 28px; }
            .content { background: #f8fafc; padding: 30px; border-radius: 0 0 8px 8px; }
            .button { display: inline-block; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 14px 32px; text-decoration: none; border-radius: 8px; font-weight: bold; margin: 20px 0; }
            .footer { text-align: center; margin-top: 30px; color: #64748b; font-size: 14px; }
            .benefits { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
            .benefit-item { padding: 10px 0; border-bottom: 1px solid #e2e8f0; }
            .benefit-item:last-child { border-bottom: none; }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="header">
              <h1>üìä Welcome to GCC Signal Pro!</h1>
            </div>
            <div class="content">
              <p>Hi ${name || 'there'},</p>

              <p><strong>Your account is almost ready!</strong> Just one more step to get started.</p>

              <p>Click the button below to verify your email and unlock your 3 free signals:</p>

              <div style="text-align: center;">
                <a href="${verificationUrl}" class="button">
                  ‚úÖ Verify My Email
                </a>
              </div>

              <div class="benefits">
                <h3 style="margin-top: 0;">üéÅ What You Get (Free Trial):</h3>
                <div class="benefit-item">‚úÖ 3 high-quality trading signals</div>
                <div class="benefit-item">‚úÖ Real-time market analysis</div>
                <div class="benefit-item">‚úÖ AI-powered recommendations</div>
                <div class="benefit-item">‚úÖ No credit card required</div>
              </div>

              <p><strong>Want unlimited access?</strong> Open an Exness account with just $10 and get premium access FREE forever! (Worth $99/month)</p>

              <p style="margin-top: 30px; font-size: 12px; color: #64748b;">
                If the button doesn't work, copy and paste this link:<br>
                <a href="${verificationUrl}">${verificationUrl}</a>
              </p>

              <p style="margin-top: 30px; font-size: 12px; color: #64748b;">
                This link expires in 24 hours. If you didn't create an account, please ignore this email.
              </p>
            </div>
            <div class="footer">
              <p>¬© 2025 GCC Signal Pro. All rights reserved.</p>
              <p>Professional trading signals for Gulf markets</p>
            </div>
          </div>
        </body>
        </html>
      `
    })

    console.log('Verification email sent to:', email)
    return { success: true }

  } catch (error) {
    console.error('Failed to send verification email:', error)
    return { success: false, error }
  }
}

export async function sendUpgradePromotionEmail(
  email: string,
  name: string,
  viewsUsed: number
) {
  const exnessLink = process.env.EXNESS_DESKTOP_LINK || 'https://exness.com'

  try {
    await resend.emails.send({
      from: fromEmail,
      to: email,
      subject: 'üéÅ Unlock Unlimited Signals - Free with Exness',
      html: `
        <!DOCTYPE html>
        <html>
        <head>
          <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }
            .header h1 { color: #1e293b; margin: 0; font-size: 28px; }
            .content { background: #f8fafc; padding: 30px; border-radius: 0 0 8px 8px; }
            .button { display: inline-block; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 16px 40px; text-decoration: none; border-radius: 8px; font-weight: bold; margin: 20px 0; font-size: 18px; }
            .stats { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center; }
            .stat-number { font-size: 48px; font-weight: bold; background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
            .features { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
            .feature { padding: 15px; display: flex; align-items: center; gap: 15px; }
            .emoji { font-size: 32px; }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="header">
              <h1>üíé Ready for More Signals?</h1>
            </div>
            <div class="content">
              <p>Hi ${name},</p>

              <div class="stats">
                <div class="stat-number">${viewsUsed}/3</div>
                <p style="color: #64748b; margin: 5px 0 0 0;">Free signals used</p>
              </div>

              <p><strong>Great news!</strong> You can get unlimited access to all our premium features completely FREE.</p>

              <div class="features">
                <h3 style="margin-top: 0; text-align: center;">üéÅ Premium Benefits:</h3>
                <div class="feature">
                  <span class="emoji">üìä</span>
                  <div>
                    <strong>Unlimited Daily Signals</strong><br>
                    <span style="color: #64748b; font-size: 14px;">Get all signals, not just 3</span>
                  </div>
                </div>
                <div class="feature">
                  <span class="emoji">üì∞</span>
                  <div>
                    <strong>Real-Time Market News</strong><br>
                    <span style="color: #64748b; font-size: 14px;">Stay ahead of market movements</span>
                  </div>
                </div>
                <div class="feature">
                  <span class="emoji">üéì</span>
                  <div>
                    <strong>Trading Education</strong><br>
                    <span style="color: #64748b; font-size: 14px;">Courses, webinars, and strategies</span>
                  </div>
                </div>
                <div class="feature">
                  <span class="emoji">üìà</span>
                  <div>
                    <strong>Advanced Analysis</strong><br>
                    <span style="color: #64748b; font-size: 14px;">AI-powered market insights</span>
                  </div>
                </div>
              </div>

              <div style="background: #fef3c7; border-left: 4px solid #fbbf24; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <h3 style="margin-top: 0; color: #92400e;">üí∞ How to Get Free Access:</h3>
                <ol style="color: #78350f; margin: 0;">
                  <li>Open an Exness trading account (just $10 minimum)</li>
                  <li>Submit your account number in our app</li>
                  <li>Get verified within 24 hours</li>
                  <li>Enjoy premium access FREE forever!</li>
                </ol>
              </div>

              <p style="text-align: center; font-size: 18px; color: #64748b;">
                <strong>Regular Price:</strong> <span style="text-decoration: line-through;">$99/month</span><br>
                <strong style="color: #10b981; font-size: 24px;">Your Price: FREE</strong> üéâ
              </p>

              <div style="text-align: center;">
                <a href="${exnessLink}" class="button">
                  üöÄ Open Exness Account Now
                </a>
              </div>

              <p style="text-align: center; font-size: 14px; color: #64748b; margin-top: 30px;">
                Already have an Exness account?<br>
                <a href="${appUrl}/dashboard" style="color: #3b82f6;">Submit it here for verification</a>
              </p>
            </div>
          </div>
        </body>
        </html>
      `
    })

    console.log('Upgrade promotion email sent to:', email)
    return { success: true }

  } catch (error) {
    console.error('Failed to send upgrade email:', error)
    return { success: false, error }
  }
}

export async function sendAccountVerifiedEmail(
  email: string,
  name: string
) {
  try {
    await resend.emails.send({
      from: fromEmail,
      to: email,
      subject: 'üéâ Congratulations! Your Premium Access is Active',
      html: `
        <!DOCTYPE html>
        <html>
        <head>
          <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 40px; text-align: center; border-radius: 8px 8px 0 0; }
            .header h1 { color: white; margin: 0; font-size: 32px; }
            .content { background: #f8fafc; padding: 30px; border-radius: 0 0 8px 8px; }
            .button { display: inline-block; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 16px 40px; text-decoration: none; border-radius: 8px; font-weight: bold; margin: 20px 0; font-size: 18px; }
            .badge { display: inline-block; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #1e293b; padding: 12px 24px; border-radius: 12px; font-weight: bold; margin: 20px 0; font-size: 20px; }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="header">
              <h1>üéâ Welcome to Premium!</h1>
            </div>
            <div class="content">
              <p>Hi ${name},</p>

              <p style="font-size: 18px;"><strong>Congratulations! Your Exness account has been verified.</strong></p>

              <div style="text-align: center; margin: 30px 0;">
                <div class="badge">üíé PREMIUM MEMBER</div>
              </div>

              <p>You now have <strong>UNLIMITED ACCESS</strong> to all premium features:</p>

              <ul style="font-size: 16px; line-height: 2;">
                <li>‚úÖ Unlimited daily signals</li>
                <li>‚úÖ Real-time market news & analysis</li>
                <li>‚úÖ Complete trading education library</li>
                <li>‚úÖ Advanced market analytics</li>
                <li>‚úÖ Priority customer support</li>
                <li>‚úÖ Exclusive webinars & courses</li>
              </ul>

              <div style="text-align: center;">
                <a href="${appUrl}/dashboard" class="button">
                  üöÄ Start Trading Now
                </a>
              </div>

              <div style="background: #dbeafe; padding: 20px; border-radius: 8px; margin-top: 30px; border-left: 4px solid #3b82f6;">
                <p style="margin: 0;"><strong>Pro Tip:</strong> Check your signals daily for the best trading opportunities in GCC markets!</p>
              </div>

              <p style="margin-top: 30px;">Happy trading!</p>
              <p><strong>The GCC Signal Pro Team</strong></p>
            </div>
          </div>
        </body>
        </html>
      `
    })

    console.log('Account verified email sent to:', email)
    return { success: true }

  } catch (error) {
    console.error('Failed to send verification success email:', error)
    return { success: false, error }
  }
}</pre>

            <div class="step-box">
                <h4>Step 10.4: Update Registration Route to Send Email</h4>
                <p>In <code>src/app/api/auth/register/route.ts</code>, add this import and call:</p>
            </div>

            <pre>import { sendVerificationEmail } from '@/lib/email'

// After creating verification token:
await sendVerificationEmail(
  email,
  fullName || email.split('@')[0],
  verificationToken
)</pre>

            <div class="success-box">
                <h4>‚úÖ Email System Complete!</h4>
                <p>Your app can now send beautiful HTML emails for verification and promotions.</p>
            </div>
        </div>

        <!-- Testing & Launch -->
        <div class="section" id="testing">
            <h2>1Ô∏è‚É£1Ô∏è‚É£ Testing & Launch</h2>

            <h3>Testing Checklist</h3>

            <ul class="checklist">
                <li><strong>Registration Flow</strong>
                    <ul>
                        <li>Register with valid email</li>
                        <li>Check email for verification link</li>
                        <li>Click verification link</li>
                        <li>Confirm email_verified = true in database</li>
                    </ul>
                </li>
                <li><strong>Login Flow</strong>
                    <ul>
                        <li>Login with verified account</li>
                        <li>Check JWT token is stored</li>
                        <li>Refresh page - should stay logged in</li>
                    </ul>
                </li>
                <li><strong>Free Trial</strong>
                    <ul>
                        <li>View first signal - counter shows 2/3 left</li>
                        <li>View second signal - counter shows 1/3 left</li>
                        <li>View third signal - counter shows 0/3 left</li>
                        <li>Try to view fourth - paywall appears</li>
                    </ul>
                </li>
                <li><strong>Broker Submission</strong>
                    <ul>
                        <li>Click upgrade button</li>
                        <li>Submit Exness account number</li>
                        <li>Check database - status = pending</li>
                        <li>Admin approves</li>
                        <li>User access_tier = premium</li>
                        <li>User gets unlimited access</li>
                    </ul>
                </li>
            </ul>

            <div class="step-box">
                <h4>Step 11.1: Local Testing</h4>
                <div class="command">npm run dev</div>
                <p>Open <code>http://localhost:3000</code> and test all features</p>
            </div>

            <div class="step-box">
                <h4>Step 11.2: Deploy to Production</h4>
                <ol>
                    <li>Commit all changes:
                        <div class="command">git add . && git commit -m "‚ú® Add authentication and broker verification system"</div>
                    </li>
                    <li>Push to GitHub:
                        <div class="command">git push origin main</div>
                    </li>
                    <li>In Render dashboard:
                        <ul>
                            <li>Go to your service</li>
                            <li>Click <strong>"Environment"</strong></li>
                            <li>Add all environment variables from <code>.env.local</code></li>
                            <li>Click <strong>"Save Changes"</strong></li>
                        </ul>
                    </li>
                    <li>Render will automatically deploy (5-10 minutes)</li>
                </ol>
            </div>

            <div class="warning-box">
                <h4>‚ö†Ô∏è Pre-Launch Checklist</h4>
                <ul class="checklist">
                    <li>All environment variables set in Render</li>
                    <li>Supabase database tables created</li>
                    <li>Resend domain verified (if using custom domain)</li>
                    <li>Exness affiliate links working</li>
                    <li>Test user registration end-to-end</li>
                    <li>Test paywall appears after 3 views</li>
                    <li>Test broker verification flow</li>
                    <li>Create your admin user in database</li>
                </ul>
            </div>
        </div>

        <!-- Monitoring -->
        <div class="section" id="monitoring">
            <h2>1Ô∏è‚É£2Ô∏è‚É£ Monitoring & Analytics</h2>

            <h3>Key Metrics Dashboard</h3>

            <div class="grid-2">
                <div class="metric-card">
                    <h4>Total Registrations</h4>
                    <div class="metric-value">Track</div>
                    <div class="metric-label">Query: SELECT COUNT(*) FROM users</div>
                </div>

                <div class="metric-card">
                    <h4>Email Verified Rate</h4>
                    <div class="metric-value">Track</div>
                    <div class="metric-label">verified / total * 100</div>
                </div>

                <div class="metric-card">
                    <h4>Premium Conversions</h4>
                    <div class="metric-value">Track</div>
                    <div class="metric-label">access_tier = 'premium'</div>
                </div>

                <div class="metric-card">
                    <h4>Conversion Rate</h4>
                    <div class="metric-value">Track</div>
                    <div class="metric-label">premium / verified * 100</div>
                </div>
            </div>

            <h3>SQL Queries for Analytics</h3>

            <pre>-- Daily new registrations
SELECT
  DATE(created_at) as date,
  COUNT(*) as registrations
FROM users
GROUP BY DATE(created_at)
ORDER BY date DESC
LIMIT 30;

-- Conversion funnel
SELECT
  COUNT(*) as total_users,
  SUM(CASE WHEN email_verified THEN 1 ELSE 0 END) as verified_users,
  SUM(CASE WHEN access_tier = 'premium' THEN 1 ELSE 0 END) as premium_users,
  ROUND(SUM(CASE WHEN email_verified THEN 1 ELSE 0 END)::numeric / COUNT(*) * 100, 2) as verification_rate,
  ROUND(SUM(CASE WHEN access_tier = 'premium' THEN 1 ELSE 0 END)::numeric /
        SUM(CASE WHEN email_verified THEN 1 ELSE 0 END) * 100, 2) as premium_conversion_rate
FROM users;

-- Pending broker verifications
SELECT
  u.email,
  u.full_name,
  b.account_number,
  b.submitted_at,
  EXTRACT(HOUR FROM NOW() - b.submitted_at) as hours_pending
FROM broker_accounts b
JOIN users u ON b.user_id = u.id
WHERE b.verification_status = 'pending'
ORDER BY b.submitted_at ASC;

-- User activity in last 7 days
SELECT
  u.email,
  u.access_tier,
  COUNT(*) as total_views,
  COUNT(CASE WHEN ua.content_type = 'signal' THEN 1 END) as signal_views,
  COUNT(CASE WHEN ua.content_type = 'news' THEN 1 END) as news_views,
  MAX(ua.created_at) as last_activity
FROM users u
LEFT JOIN user_activity ua ON u.id = ua.user_id
WHERE ua.created_at > NOW() - INTERVAL '7 days'
GROUP BY u.id, u.email, u.access_tier
ORDER BY total_views DESC;</pre>

            <div class="success-box">
                <h4>üéâ Implementation Complete!</h4>
                <p>You now have a fully functional authentication and monetization system!</p>
            </div>
        </div>

        <!-- Quick Reference -->
        <div class="section">
            <h2>üìö Quick Reference Guide</h2>

            <h3>Important URLs</h3>
            <table>
                <tr>
                    <th>Service</th>
                    <th>URL</th>
                    <th>Purpose</th>
                </tr>
                <tr>
                    <td>Supabase</td>
                    <td><a href="https://supabase.com/dashboard" target="_blank">supabase.com/dashboard</a></td>
                    <td>Database management</td>
                </tr>
                <tr>
                    <td>Resend</td>
                    <td><a href="https://resend.com/emails" target="_blank">resend.com/emails</a></td>
                    <td>Email delivery logs</td>
                </tr>
                <tr>
                    <td>Render</td>
                    <td><a href="https://dashboard.render.com" target="_blank">dashboard.render.com</a></td>
                    <td>Hosting & deployments</td>
                </tr>
                <tr>
                    <td>Exness Partners</td>
                    <td><a href="https://www.exness.com/partners/" target="_blank">exness.com/partners</a></td>
                    <td>Affiliate dashboard</td>
                </tr>
            </table>

            <h3>Common Commands</h3>
            <div class="command">npm run dev  # Start development server</div>
            <div class="command">npm run build  # Build for production</div>
            <div class="command">git add . && git commit -m "message" && git push  # Deploy changes</div>

            <h3>Support & Resources</h3>
            <ul>
                <li>Supabase Docs: <a href="https://supabase.com/docs" target="_blank">supabase.com/docs</a></li>
                <li>Next.js Docs: <a href="https://nextjs.org/docs" target="_blank">nextjs.org/docs</a></li>
                <li>Resend Docs: <a href="https://resend.com/docs" target="_blank">resend.com/docs</a></li>
            </ul>
        </div>

        <!-- Footer -->
        <div style="text-align: center; margin: 60px 0 20px 0; padding: 30px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 16px;">
            <h2 style="margin-bottom: 15px;">üéâ Ready to Launch?</h2>
            <p style="font-size: 18px; color: #64748b; margin-bottom: 20px;">
                Follow this guide step-by-step and you'll have a professional monetization system ready in days, not months!
            </p>
            <p style="font-size: 16px; color: #475569;">
                <strong>Need help?</strong> Claude is here to assist with implementation!
            </p>
        </div>

        <div style="text-align: center; color: #94a3b8; font-size: 14px; padding: 20px 0;">
            <p>Generated with ‚ù§Ô∏è by Claude Code</p>
            <p>Last Updated: January 2025</p>
        </div>
    </div>

    <script>
        // Add smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Print button
        console.log('üìÑ Implementation Guide Loaded Successfully!');
        console.log('üí° Tip: Press Ctrl+P (Cmd+P on Mac) to print or save as PDF');
    </script>
</body>
</html>